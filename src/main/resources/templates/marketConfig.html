<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>藝覽無遺 eView - 活動設定</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        footer {
            background-color: #073046;
            color: white;
            text-align: center;
            padding: 20px 0;
        }

        header {
            background-color: #F7DEA0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            height: 60px;
        }

        #notification-icon i,
        .btn-link i {
            color: #073046;
            vertical-align: middle;
        }

        .header-content {
            width: 90%;
            margin: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-weight: bold;
            height: 100%;
            gap: 10px;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-left img {
            height: 40px;
            margin-right: 10px;
        }

        .logo-text {
            color: #073046;
            font-size: 24px;
            font-weight: bold;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #073046;
            font-size: 18px;
            font-weight: bold;
            margin-left: 20px;
            position: relative;
            transition: 0.3s;
        }

        .nav-btn::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -3px;
            width: 0;
            height: 2px;
            background-color: #ff8c00;
            transition: width 0.3s;
        }

        .nav-btn:hover::after,
        .nav-btn.active::after {
            width: 100%;
        }

        .nav-btn:hover,
        .nav-btn.active {
            color: #ff8c00;
        }


        body {
            background-color: #fff;
            font-family: sans-serif;
            padding-top: 80px;
        }

        .main-container {
            width: 80%;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            min-height: 650px;
        }

        .sidebar {
            width: 20%;
            background-color: #fdf0d8;
            border-radius: 16px;
            height: 700px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            min-height: 750px;
        }

        .sidebar button {
            width: 80%;
            height: 60px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 18px;
            color: white;
            background-color: #C4C4C4;

        }

        .sidebar button.active {
            background-color: #FF725E;
        }

        .content {
            width: 80%;
            background-color: white;
            padding: 20px;
            border-radius: 20px;
        }

        .form-label {
            font-weight: bold;
            color: #073046;
        }

        .time-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .time-row input {
            width: auto;
        }

        .delete-btn {
            background: none;
            border: none;
            color: red;
            font-size: 20px;
        }

        .notice-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .notice-filter button {
            border: 1px solid #FF725E;
            background-color: white;
            padding: 6px 12px;
            border-radius: 8px;
        }

        .notice-card {
            background-color: #fff4e6;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .schedule-upload {
            border: 2px dashed #aaa;
            text-align: center;
            padding: 40px;
            margin-bottom: 20px;
            border-radius: 12px;
        }

        .schedule-preview {
            display: flex;
            gap: 20px;
        }

        .schedule-preview img {
            width: 30%;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1050;
        }

        .modal-box {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 500px;
        }

        .form-label,
        .form-control,
        .btn {
            font-size: 18px;
            color: #073046;
        }

        .form-control::placeholder {
            color: #999;
        }

        .btn-outline-primary.custom-add-btn {
            color: gray;
            border: 1px solid gray;
            background-color: transparent;
            transition: background-color 0.3s, color 0.3s;
        }

        .btn-outline-primary.custom-add-btn:hover {
            background-color: #555;
            color: white;
        }

        .form-control {
            width: 70%;
        }

        .mb-3 {
            margin-bottom: 2rem !important;
        }

        .btn-danger {
            color: white;
            font-size: 1.2rem;
            padding: 10px 40px;
        }

        .btn-secondary {
            color: white;
        }

        .button-wrapper {
            margin-top: 2rem;
            text-align: right;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #073046;
            margin-bottom: 1rem;
        }

        .contact-field {
            margin-bottom: 1.5rem;
        }

        .notice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .notice-header h4 {
            font-size: 1.6rem;
            color: #073046;
            margin-right: 2rem;
            margin-bottom: 0;
        }

        .notice-tabs {
            display: flex;
            gap: 10px;
        }

        .notice-tabs button {
            background: none;
            border: 2px solid transparent;
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: bold;
            color: #073046;
        }

        .notice-tabs button.active {
            border-color: #FF725E;
        }

        .notice-card {
            background-color: #fff4e6;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .notice-card h5 {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .notice-card small {
            float: right;
            color: gray;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.4);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1050;
        }

        .modal-box {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 500px;
        }

        #modalTitle {
            font-size: 1.6rem;
            text-align: center;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #073046;
        }

        .modal-box h5#modalTitle {
            font-size: 1.6rem;
            text-align: center;
            font-weight: bold;
            margin-bottom: 1.5rem;
            color: #073046;
        }

        .modal-box .form-control,
        .modal-box .form-select,
        .modal-box textarea.form-control {
            width: 100% !important;
            max-width: 100%;
            min-height: 70px;
        }

        .modal-box .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-box .modal-footer .btn {
            min-width: 100px;
            padding: 10px 20px;
            font-size: 1rem;
        }
    </style>
    <script>
        function switchTab(tab) {
            document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tab + 'Btn').classList.add('active');
            document.querySelectorAll('.content-section').forEach(sec => sec.style.display = 'none');
            document.getElementById(tab + 'Section').style.display = 'block';
        }

        function addTimeRow() {
            const container = document.getElementById('eventTimes');
            const row = document.createElement('div');
            row.className = 'time-row';
            row.innerHTML = `
                <input type="date" name="startDate" class="form-control">
                <input type="time" name="startTime" class="form-control">
                <input type="date" name="endDate" class="form-control">
                <input type="time" name="endTime" class="form-control">
                <button class="delete-btn" onclick="this.parentElement.remove()">&times;</button>
            `;
            container.appendChild(row);
        }

        function toggleModal(show) {
            document.getElementById('noticeModal').style.display = show ? 'flex' : 'none';
        }
    </script>
</head>

<body>

    <!-- ✅ 自動引入 flash message 區塊 -->
    <div th:replace="~{fragments/flash-message :: flashMessage}"></div>

    <header>
        <div class="header-content">
            <div class="header-left">
                <img th:src="@{/images/logo.png}" alt="logo">
                <span class="logo-text">藝覽無遺 eView</span>
            </div>
            <div class="d-flex align-items-center" style="gap: 10px;">
                <form th:action="@{/eView/organizer/config}" method="get" style="display:inline;">
                    <button class="nav-btn active">活動設定</button>
                </form>
                <form th:action="@{/eView/organizer/map}" method="get" style="display:inline;">
                    <button class="nav-btn">會場佈置</button>
                </form>
                <form th:action="@{/eView/organizer/activity}" method="get" style="display:inline;">
                    <button class="nav-btn">抽獎系統</button>
                </form>
                <form th:action="@{/eView/organizer/review}" method="get" style="display:inline;">
                    <button class="nav-btn">招商狀況</button>
                </form>

                <form th:action="@{/eView/organizer/profile}" method="get">
                    <button class="btn btn-link">
                        <i class="bi bi-person-circle" style="font-size: 1.5rem;"></i>
                    </button>
                </form>
            </div>
        </div>
    </header>

    <body>

        <div class="main-container">
            <div class="sidebar">
                <button id="marketBtn" class="active" onclick="switchTab('market')">市集資訊</button>
                <button id="noticeBtn" onclick="switchTab('notice')">臨時公告</button>
                <button id="scheduleBtn" onclick="switchTab('schedule')">節目表</button>
            </div>

            <div class="content">
                <!-- ✅ 市集資訊 -->
                <div id="marketSection" class="content-section">
                    <h4 class="mb-4" style="color: #073046; font-size: 2rem; font-weight: bold;">活動設定</h4>
                    <form th:action="@{/eView/organizer/config/save}" method="post">
                        <!-- 市集名稱與地點 -->
                        <div class="mb-3">
                            <label class="section-title">市集名稱</label>
                            <input type="text" name="marketName" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="section-title">地點</label>
                            <input type="text" name="location" class="form-control">
                        </div>

                        <!-- 舉辦時間 -->
                        <div class="mb-3">
                            <label class="section-title">舉辦時間</label>
                            <div id="eventTimes">
                                <!-- 3 個固定時段 -->
                                <div class="time-row">
                                    <input type="date" name="eventPeriods[0].startDate" class="form-control" />
                                    <input type="time" name="eventPeriods[0].startTime" class="form-control" />
                                    <input type="date" name="eventPeriods[0].endDate" class="form-control" />
                                    <input type="time" name="eventPeriods[0].endTime" class="form-control" />
                                </div>
                                <div class="time-row">
                                    <input type="date" name="eventPeriods[1].startDate" class="form-control" />
                                    <input type="time" name="eventPeriods[1].startTime" class="form-control" />
                                    <input type="date" name="eventPeriods[1].endDate" class="form-control" />
                                    <input type="time" name="eventPeriods[1].endTime" class="form-control" />
                                </div>
                                <div class="time-row">
                                    <input type="date" name="eventPeriods[2].startDate" class="form-control" />
                                    <input type="time" name="eventPeriods[2].startTime" class="form-control" />
                                    <input type="date" name="eventPeriods[2].endDate" class="form-control" />
                                    <input type="time" name="eventPeriods[2].endTime" class="form-control" />
                                </div>
                            </div>
                        </div>

                        <!-- 招商時間 -->
                        <div class="mb-3">
                            <label class="section-title">招商時間</label>
                            <div class="time-row">
                                <input type="date" name="recruitStartDate" class="form-control">
                                <input type="time" name="recruitStartTime" class="form-control">
                            </div>
                            <div class="time-row mt-2">
                                <input type="date" name="recruitEndDate" class="form-control">
                                <input type="time" name="recruitEndTime" class="form-control">
                            </div>
                        </div>

                        <!-- 聯絡資訊 -->
                        <div class="mb-3">
                            <label class="section-title">聯絡資訊</label>
                            <span class="form-label">信箱：</span>
                            <input type="email" name="email" class="form-control" placeholder="example@gmail.com">
                            <span class="form-label">FB：</span>
                            <input type="text" name="facebook" class="form-control mt-1"
                                placeholder="http://facebook.com/yourpage">
                                <span class="form-label">IG：</span>
                            <input type="text" name="instagram" class="form-control mt-1"
                                placeholder="http://instagram.com/yourpage">
                                <span class="form-label">LINE：</span>
                            <input type="text" name="line" class="form-control mt-1" placeholder="@yourline">
                            <span class="form-label">網站：</span>
                            <input type="text" name="website" class="form-control mt-1"
                                placeholder="http://yourwebsite.com">
                        </div>

                        <div class="button-wrapper">
                            <button class="btn btn-danger" type="submit">儲存更改</button>
                        </div>
                    </form>
                </div>

                <!-- ✅ 臨時公告 -->
                <div id="noticeSection" class="content-section" style="display: none;">
                    <div class="notice-header">
                        <h4>臨時公告</h4>
                        <div class="notice-tabs">
                            <button class="active" onclick="setTab(this)">全部</button>
                            <button onclick="setTab(this)">一般使用者</button>
                            <button onclick="setTab(this)">攤商</button>
                        </div>
                        <button class="btn btn-danger" onclick="openNoticeModal('新增臨時公告')">新增公告</button>
                    </div>

                    <div th:if="${notices != null and !notices.isEmpty()}">
                        <div th:each="notice : ${notices}"  th:attr="data-target=${notice.target}" class="notice-card">
                            <h5><span th:text="${notice.title}">公告標題</span></h5>
                            <p th:text="${notice.content}">這裡是公告內文內容</p>
                            <div class="text-end d-flex gap-2 justify-content-end align-items-center">
                                <form th:action="@{/eView/organizer/config/delete}" method="post" class="m-0 p-0">
                                    <input type="hidden" name="id" th:value="${notice.id}">
                                    <button class="btn btn-secondary" type="submit">刪除</button>
                                </form>
                                <button class="btn btn-warning"
                                    th:attr="data-title=${notice.title}, data-content=${notice.content}, data-target=${notice.target}, data-id=${notice.id}"
                                    onclick="handleEditNotice(this)">編輯</button>
                            </div>
                        </div>
                    </div>
                    <div th:if="${notices == null or notices.isEmpty()}">
                        <p>目前沒有公告</p>
                    </div>
                </div>

                <!-- ✅ 節目表 -->
                <div id="scheduleSection" class="content-section" style="display: none;">
                    <h5 class="section-title">節目表（至多3張）</h5>
                    <p>上傳節目表（尺寸必須為1080×1080 px）</p>
                    <div class="schedule-upload">
                        <p>上傳圖片<br>或將圖片拖曳至此</p>
                    </div>
                    <div class="schedule-preview">
                        <img th:src="@{/images/schedule1.png}">
                        <img th:src="@{/images/schedule2.png}">
                        <img th:src="@{/images/schedule3.png}">
                    </div>
                </div>
            </div>
        </div>

        <!-- ✅ Modal -->
        <div id="noticeModal" class="modal-overlay" onclick="toggleModal(false)">
            <div class="modal-box" onclick="event.stopPropagation()">
                <!-- 📝 Modal 表單 (固定送到 /config/new) -->
                <form   id="noticeForm"  th:action="@{/eView/organizer/config/new}" method="post">
                    <input type="hidden" name="id" id="noticeId">

                    <h5 id="modalTitle">新增臨時公告</h5>

                    <div class="mb-3">
                        <label class="form-label">* 標題（限20字）</label>
                        <input type="text" name="title" id="noticeTitle" class="form-control" maxlength="20" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">內文（限150字）</label>
                        <textarea name="content" id="noticeContent" class="form-control" maxlength="150"
                            required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">發布對象</label>
                        <select name="target" id="noticeTarget" class="form-select">
                            <option value="一般使用者">一般使用者</option>
                            <option value="攤商">攤商</option>
                        </select>
                    </div>

                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" onclick="toggleModal(false)">取消</button>
                        <button class="btn btn-danger" type="submit">發布</button>
                    </div>
                </form>

            </div>
        </div>

        <!-- ✅ Script -->
        <script>
            function toggleModal(show) {
                document.getElementById('noticeModal').style.display = show ? 'flex' : 'none';
            }

            function handleEditNotice(button) {
                const title = button.getAttribute('data-title');
                const content = button.getAttribute('data-content');
                const target = button.getAttribute('data-target');
                const id = button.getAttribute('data-id');
                openNoticeModal('編輯公告', title, content, target, id);
            }

            function openNoticeModal(title, presetTitle = '', presetContent = '', presetTarget = '一般使用者', noticeId = '') {
                document.getElementById('modalTitle').innerText = title;
                document.getElementById('noticeTitle').value = presetTitle;
                document.getElementById('noticeContent').value = presetContent;
                document.getElementById('noticeTarget').value = presetTarget;
                document.getElementById('noticeId').value = noticeId;

                const form = document.getElementById('noticeForm');
                form.action = title.includes('新增') ? '/eView/organizer/config/new' : '/eView/organizer/config/edit';
                toggleModal(true);
            }

    function setTab(button) {
        // 樣式切換
        document.querySelectorAll('.notice-tabs button').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');

        const filter = button.innerText.trim(); // 例如 "一般使用者"
        const cards = document.querySelectorAll('.notice-card');

        cards.forEach(card => {
            const target = card.getAttribute('data-target');
            if (filter === '全部' || target === filter) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }



            function switchTab(tabName) {
                document.querySelectorAll('.content-section').forEach(section => section.style.display = 'none');
                document.getElementById(tabName + 'Section').style.display = 'block';

                document.querySelectorAll('.sidebar button').forEach(btn => btn.classList.remove('active'));
                document.getElementById(tabName + 'Btn').classList.add('active');
            }
        </script>

        <footer class="text-center mt-4">
            <p>© 2025 eView. All Rights Reserved.</p>
        </footer>

    </body>

</html>