<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>會場地圖</title>
    <!-- Bootstrap & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <style>
        footer {
            background-color: #073046;
            color: white;
            text-align: center;
            padding: 20px 0;
        }

        #notification-icon i,
        .btn-link i {
            color: #073046;
            vertical-align: middle;
        }

        header {
            background-color: #F7DEA0;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            height: 60px;
        }

        .header-content {
            width: 90%;
            margin: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-weight: bold;
            height: 100%;
            gap: 10px;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-left img {
            height: 40px;
            margin-right: 10px;
        }

        .logo-text {
            color: #073046;
            font-size: 24px;
            font-weight: bold;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #073046;
            font-size: 18px;
            font-weight: bold;
            margin-left: 20px;
            position: relative;
            transition: 0.3s;
        }

        .nav-btn::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -3px;
            width: 0;
            height: 2px;
            background-color: #ff8c00;
            transition: width 0.3s;
        }

        .nav-btn:hover::after,
        .nav-btn.active::after {
            width: 100%;
        }

        .nav-btn:hover,
        .nav-btn.active {
            color: #ff8c00;
        }

        .main-title {
            width: 80%;
            margin: 50px auto 20px auto;
            text-align: left;
            font-size: 28px;
            font-weight: bold;
            color: #073046;
        }

        .main-wrapper {
            width: 80%;
            margin: 100px auto 30px auto;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .map-header h2 {
            color: #073046;
            font-weight: bold;
        }

        .map-container {
            position: relative;
            background-color: #fdf0d8;
            border-radius: 30px;
            padding: 30px;
            height: 500px;
            margin-bottom: 40px;
        }

        .booth-btn {
            position: absolute;
            width: 115px;
            height: 125px;
            background-color: #ccc;
            color: #073046;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            text-align: center;
            line-height: 50px;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center
        }

        .map-label {
            position: absolute;
            color: #073046;
            font-weight: bold;
            font-size: 24px;
        }

        .booth-btn:hover {
            transform: scale(1.05);
            background-color: #999;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 40px;
        }

        .filter-btn {
            display: inline-block;
            cursor: pointer;
            border: 2px solid #ccc;
            background-color: white;
            border-radius: 30px;
            padding: 10px 20px;
            font-weight: bold;
            color: #444;
            transition: 0.2s;
            user-select: none;
        }

        .filter-btn input:checked+span,
        .filter-btn:has(input:checked) {
            background-color: #ff7043;
            color: white;
            border-color: #ff7043;
        }
    </style>
</head>

<body>
    <!-- ✅ 自動引入 flash message 區塊 -->
    <div th:replace="~{fragments/flash-message :: flashMessage}"></div>

    <header>
        <div class="header-content">
            <div class="header-left">
                <img th:src="@{/images/logo.png}" alt="logo">
                <span class="logo-text">藝覽無遺 eView</span>
            </div>
            <div class="d-flex align-items-center" style="gap: 10px;">
                <form th:action="@{/eView/organizer/config}" method="get" style="display:inline;">
                    <button class="nav-btn">活動設定</button>
                </form>
                <form th:action="@{/eView/organizer/map}" method="get" style="display:inline;">
                    <button class="nav-btn">會場佈置</button>
                </form>
                <form th:action="@{/eView/organizer/activity}" method="get" style="display:inline;">
                    <button class="nav-btn active">抽獎系統</button>
                </form>
                <form th:action="@{/eView/organizer/review}" method="get" style="display:inline;">
                    <button class="nav-btn">招商狀況</button>
                </form>

                <form th:action="@{/eView/organizer/profile}" method="get">
                    <button class="btn btn-link">
                        <i class="bi bi-person-circle" style="font-size: 1.5rem;"></i>
                    </button>
                </form>
            </div>
        </div>
    </header>

    <div class="main-wrapper">
        <!-- ⛳ 標題與篩選器 -->
        <div class="map-header">
            <h2>會場地圖</h2>
        </div>
        <!-- 地圖容器 -->
        <!-- 會場地圖 -->
        <div class="map-container">

            <!-- 標籤區 -->
            <div class="map-label" style="top: 25px; left: 300px;">資訊大樓</div>
            <div class="map-label" style="top: 25px; right: 315px;">商學院</div>
            <div class="map-label" style="top: 435px; left: 300px;">行政大樓</div>
            <div class="map-label" style="top: 230px; left: 600px;">四維道（中間的人行道）</div>
            <div class="map-label" style="top: 420px; left: 685px;">四維堂</div>
            <div class="map-label" style="top: 435px; right: 290px;">中正圖書館</div>

            <!-- 第一排：A1 ~ C2 -->
            <div class="booth-btn" onclick="openVendorModal('1')" th:with="vendor=${boothVendorMap['1']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; left: 50px;">1</div>
            <div class="booth-btn" onclick="openVendorModal('2')" th:with="vendor=${boothVendorMap['2']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; left: 170px;">2
            </div>
            <div class="booth-btn" onclick="openVendorModal('3')" th:with="vendor=${boothVendorMap['3']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; left: 290px;">3
            </div>
            <div class="booth-btn" onclick="openVendorModal('4')" th:with="vendor=${boothVendorMap['4']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; left: 410px;">4
            </div>
            <div class="booth-btn" onclick="openVendorModal('5')" th:with="vendor=${boothVendorMap['5']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; left: 530px;">5
            </div>

            <div class="booth-btn" onclick="openVendorModal('10')" th:with="vendor=${boothVendorMap['10']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; right: 50px;">10
            </div>
            <div class="booth-btn" onclick="openVendorModal('9')" th:with="vendor=${boothVendorMap['9']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; right: 170px;">9
            </div>
            <div class="booth-btn" onclick="openVendorModal('8')" th:with="vendor=${boothVendorMap['8']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; right: 290px;">8
            </div>
            <div class="booth-btn" onclick="openVendorModal('7')" th:with="vendor=${boothVendorMap['7']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; right: 410px;">7
            </div>
            <div class="booth-btn" onclick="openVendorModal('6')" th:with="vendor=${boothVendorMap['6']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 80px; right: 530px;">6
            </div>


            <!-- 第二排：E3 ~ C3 -->
            <div class="booth-btn" onclick="openVendorModal('11')" th:with="vendor=${boothVendorMap['11']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; left: 50px;">11
            </div>
            <div class="booth-btn" onclick="openVendorModal('12')" th:with="vendor=${boothVendorMap['12']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; left: 170px;">12
            </div>
            <div class="booth-btn" onclick="openVendorModal('13')" th:with="vendor=${boothVendorMap['13']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; left: 290px;">13
            </div>
            <div class="booth-btn" onclick="openVendorModal('14')" th:with="vendor=${boothVendorMap['14']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; left: 410px;">14
            </div>
            <div class="booth-btn" onclick="openVendorModal('15')" th:with="vendor=${boothVendorMap['15']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; left: 530px;">15
            </div>

            <div class="booth-btn" onclick="openVendorModal('20')" th:with="vendor=${boothVendorMap['20']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; right: 50px;">20
            </div>
            <div class="booth-btn" onclick="openVendorModal('19')" th:with="vendor=${boothVendorMap['19']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; right: 170px;">19
            </div>
            <div class="booth-btn" onclick="openVendorModal('18')" th:with="vendor=${boothVendorMap['18']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; right: 290px;">18
            </div>
            <div class="booth-btn" onclick="openVendorModal('17')" th:with="vendor=${boothVendorMap['17']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; right: 410px;">17
            </div>
            <div class="booth-btn" onclick="openVendorModal('16')" th:with="vendor=${boothVendorMap['16']}"
                th:classappend="${vendor != null} ? ' btn-filled' : ' btn-empty'" style="top: 290px; right: 530px;">16
            </div>
        </div>
        <!-- 🔽 攤商列表區塊 -->
        <div class="mt-5">
            <h3 th:text="|攤商列表－${todayDate}|"></h3>
            <div th:if="${#lists.isEmpty(vendorList)}" class="text-center mt-4 text-muted">
                目前無資料可顯示。
            </div>

            <table class="table mt-3">
                <thead>
                    <tr>
                        <th>攤商信箱</th>
                        <th>攤商名字</th>
                        <th>攤位編號</th>
                        <th>分區名稱</th>
                        <th>是否已經報到</th>
                    </tr>
                </thead>
                <tbody>
<tr th:each="vendor : ${vendorList}">
    <td th:text="${vendor.email}"></td>
    <td th:text="${vendor.name}"></td>
    <td th:text="${vendor.boothCode}"></td>
    <td th:text="${vendor.cateName}"></td>
    <td>
        <!-- ✅ 不可報到（當天不開放報到） -->
        <button th:if="${!canCheckIn}" class="btn btn-secondary" disabled>今日不可報到</button>

        <!-- ✅ 可報到且已報到 -->
        <button th:if="${canCheckIn} and ${vendor.checkedIn != 0}" class="btn btn-success" disabled>已經報到</button>

        <!-- ✅ 可報到但尚未報到 -->
        <form th:if="${canCheckIn} and ${vendor.checkedIn == 0}" th:action="@{/eView/organizer/checkin}"
              method="post" style="display: inline;">
            <input type="hidden" name="vendorId" th:value="${vendor.id}" />
            <button type="submit" class="btn btn-danger">尚未報到</button>
        </form>
    </td>
</tr>

                </tbody>
            </table>
        </div>

    </div>
    <!-- 🪟 遮罩與 Modal -->
    <div id="modalOverlay" class="modal-overlay" onclick="closeModal()"></div>
    <div id="vendorModal" class="modal-box">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h5 class="text-center fw-bold" id="modalTitle">位置：A1</h5>
            <form th:action="@{/eView/organizer/booth/update}" method="post">
                <input type="hidden" name="boothCode" id="modalBoothCode">
                <label class="form-label mt-3">選擇攤商</label>
                <input type="text" id="selectedVendorDisplay" class="form-control" readonly onclick="showVendorSelect()"
                    placeholder="點擊選擇攤商">
                <input type="hidden" name="vendorId" />

                <label class="form-label mt-3">選擇類別</label>
                <select name="category" class="form-select selector-box">
                    <option th:each="cat : ${categories}" th:value="${cat.categories}" th:text="${cat.categories}">
                </select>
                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary w-50 me-2" onclick="closeModal()">取消</button>
                    <button type="submit" class="btn btn-danger w-50">確認</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 🧾 選擇攤商 Modal -->
    <div id="vendorSelectOverlay" class="modal-overlay" onclick="closeVendorSelect()"></div>
    <div id="vendorSelectModal" class="modal-box" style="width: 400px;">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h5 class="text-center fw-bold">選擇攤商</h5>
            <div class="vendor-list">
                <div th:each="vendor : ${availableVendors}" class="vendor-option" th:data-id="${vendor.id}"
                    th:text="${vendor.name}" onclick="selectVendor(this)">
                </div>
            </div>
        </div>
    </div>



    <style>
        .btn-filled {
            background-color: #cc860d;
            color: white;
        }

        .btn-empty {
            background-color: #d9d9d9;
            color: #777;
        }


        table th {
            background-color: #f2f2f2;
            color: #073046;
            font-weight: bold;
            text-align: center;
        }

        table td,
        table th {
            text-align: center;
            vertical-align: middle;
        }



        .vendor-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .vendor-option {
            border: 2px solid #ccc;
            border-radius: 20px;
            padding: 10px 20px;
            font-weight: bold;
            color: #444;
            background-color: white;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .vendor-option:hover,
        .vendor-option.selected {
            background-color: #ff8c00;
            color: white;
            border-color: #ff8c00;
        }




        .btn-orange {
            background-color: #ff8c00;
            color: white;
        }

        .btn-gray {
            background-color: #ccc;
            color: #073046;
        }


        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .modal-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            width: 320px;
            padding: 20px;
            z-index: 1000;
            display: none;
        }

        .selector-box {
            border-radius: 15px;
            border: 1px solid lightgray;
            padding: 5px;
        }




        .filtered-vendor-wrapper {
            width: 100%;
            margin: 0 auto;
        }

        .filtered-vendor-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-top: 30px;
        }

        .vendor-card {
            border: 2px solid #222;
            border-radius: 20px;
            padding: 20px;
            background-color: #fff;
            cursor: pointer;
            transition: 0.3s ease-in-out;
            box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.05);
        }

        .vendor-card:hover {
            transform: scale(1.02);
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }

        .product-item {
            margin-top: 5px;
            font-size: 15px;
        }
    </style>

    <script>

        function openVendorModal(boothCode) {
            document.getElementById('modalOverlay').style.display = 'block';
            document.getElementById('vendorModal').style.display = 'block';
            document.getElementById('modalTitle').innerText = '位置：' + boothCode;
            document.getElementById('modalBoothCode').value = boothCode;
        }


        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            document.getElementById('vendorModal').style.display = 'none';
        }

        let selectedVendorElement = null;

        function showVendorSelect() {
            document.getElementById('vendorSelectModal').style.display = 'block';
            document.getElementById('vendorSelectOverlay').style.display = 'block';
        }

        function closeVendorSelect() {
            document.getElementById('vendorSelectModal').style.display = 'none';
            document.getElementById('vendorSelectOverlay').style.display = 'none';
        }

        function selectVendor(el) {
            if (selectedVendorElement) {
                selectedVendorElement.classList.remove('selected');
            }
            el.classList.add('selected');
            selectedVendorElement = el;

            const selectedVendorName = el.innerText;
            const selectedVendorId = el.dataset.id;

            document.getElementById('selectedVendorDisplay').value = selectedVendorName;
            document.querySelector('input[name="vendorId"]').value = selectedVendorId;

            closeVendorSelect();
        }

        function closeVendorSelect() {
            document.getElementById('vendorSelectOverlay').style.display = 'none';
            document.getElementById('vendorSelectModal').style.display = 'none';
        }

    </script>
    <br>
    </div>
    <footer>
        <p class="text-center">© 2025 eView. All Rights Reserved.</p>
    </footer>
</body>

</html>